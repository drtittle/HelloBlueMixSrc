!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(){},{}],2:[function(require,module){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isNumber(arg){return"number"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isUndefined(arg){return void 0===arg}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||0>n||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(er=arguments[1],er instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(handler=this._events[type],isUndefined(handler))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1),handler.apply(this,args)}else if(isObject(handler))for(args=Array.prototype.slice.call(arguments,1),listeners=handler.slice(),len=listeners.length,i=0;len>i;i++)listeners[i].apply(this,args);return!0},EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned&&(m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,m&&m>0&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace())),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(type,listener){function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(list=this._events[type],length=list.length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;i-->0;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(0>position)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(listeners=this._events[type],isFunction(listeners))this.removeListener(type,listeners);else if(listeners)for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){var ret;return ret=this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;if(evlistener)return evlistener.length}return 0},EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)}},{}],3:[function(require,module){module.exports="function"==typeof Object.create?function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],4:[function(require,module){function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var timeout=setTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,clearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],5:[function(require,module){module.exports=function(arg){return arg&&"object"==typeof arg&&"function"==typeof arg.copy&&"function"==typeof arg.fill&&"function"==typeof arg.readUInt8}},{}],6:[function(require,module,exports){(function(process,global){function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};return arguments.length>=3&&(ctx.depth=arguments[2]),arguments.length>=4&&(ctx.colors=arguments[3]),isBoolean(opts)?ctx.showHidden=opts:opts&&exports._extend(ctx,opts),isUndefined(ctx.showHidden)&&(ctx.showHidden=!1),isUndefined(ctx.depth)&&(ctx.depth=2),isUndefined(ctx.colors)&&(ctx.colors=!1),isUndefined(ctx.customInspect)&&(ctx.customInspect=!0),ctx.colors&&(ctx.stylize=stylizeWithColor),formatValue(ctx,obj,ctx.depth)}function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];return style?"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m":str}function stylizeNoColor(str){return str}function arrayToHash(array){var hash={};return array.forEach(function(val){hash[val]=!0}),hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&(!value.constructor||value.constructor.prototype!==value)){var ret=value.inspect(recurseTimes,ctx);return isString(ret)||(ret=formatValue(ctx,ret,recurseTimes)),ret}var primitive=formatPrimitive(ctx,value);if(primitive)return primitive;var keys=Object.keys(value),visibleKeys=arrayToHash(keys);if(ctx.showHidden&&(keys=Object.getOwnPropertyNames(value)),isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0))return formatError(value);if(0===keys.length){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value))return ctx.stylize(RegExp.prototype.toString.call(value),"regexp");if(isDate(value))return ctx.stylize(Date.prototype.toString.call(value),"date");if(isError(value))return formatError(value)}var base="",array=!1,braces=["{","}"];if(isArray(value)&&(array=!0,braces=["[","]"]),isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)&&(base=" "+RegExp.prototype.toString.call(value)),isDate(value)&&(base=" "+Date.prototype.toUTCString.call(value)),isError(value)&&(base=" "+formatError(value)),0===keys.length&&(!array||0==value.length))return braces[0]+base+braces[1];if(0>recurseTimes)return isRegExp(value)?ctx.stylize(RegExp.prototype.toString.call(value),"regexp"):ctx.stylize("[Object]","special");ctx.seen.push(value);var output;return output=array?formatArray(ctx,value,recurseTimes,visibleKeys,keys):keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}),ctx.seen.pop(),reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}return isNumber(value)?ctx.stylize(""+value,"number"):isBoolean(value)?ctx.stylize(""+value,"boolean"):isNull(value)?ctx.stylize("null","null"):void 0}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){for(var output=[],i=0,l=value.length;l>i;++i)output.push(hasOwnProperty(value,String(i))?formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),!0):"");return keys.forEach(function(key){key.match(/^\d+$/)||output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,!0))}),output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;if(desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]},desc.get?str=desc.set?ctx.stylize("[Getter/Setter]","special"):ctx.stylize("[Getter]","special"):desc.set&&(str=ctx.stylize("[Setter]","special")),hasOwnProperty(visibleKeys,key)||(name="["+key+"]"),str||(ctx.seen.indexOf(desc.value)<0?(str=isNull(recurseTimes)?formatValue(ctx,desc.value,null):formatValue(ctx,desc.value,recurseTimes-1),str.indexOf("\n")>-1&&(str=array?str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2):"\n"+str.split("\n").map(function(line){return"   "+line}).join("\n"))):str=ctx.stylize("[Circular]","special")),isUndefined(name)){if(array&&key.match(/^\d+$/))return str;name=JSON.stringify(""+key),name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(name=name.substr(1,name.length-2),name=ctx.stylize(name,"name")):(name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),name=ctx.stylize(name,"string"))}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0,length=output.reduce(function(prev,cur){return numLinesEst++,cur.indexOf("\n")>=0&&numLinesEst++,prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);return length>60?braces[0]+(""===base?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]:braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}function isBoolean(arg){return"boolean"==typeof arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}function isNumber(arg){return"number"==typeof arg}function isString(arg){return"string"==typeof arg}function isSymbol(arg){return"symbol"==typeof arg}function isUndefined(arg){return void 0===arg}function isRegExp(re){return isObject(re)&&"[object RegExp]"===objectToString(re)}function isObject(arg){return"object"==typeof arg&&null!==arg}function isDate(d){return isObject(d)&&"[object Date]"===objectToString(d)}function isError(e){return isObject(e)&&("[object Error]"===objectToString(e)||e instanceof Error)}function isFunction(arg){return"function"==typeof arg}function isPrimitive(arg){return null===arg||"boolean"==typeof arg||"number"==typeof arg||"string"==typeof arg||"symbol"==typeof arg||"undefined"==typeof arg}function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return 10>n?"0"+n.toString(10):n.toString(10)}function timestamp(){var d=new Date,time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){for(var objects=[],i=0;i<arguments.length;i++)objects.push(inspect(arguments[i]));return objects.join(" ")}for(var i=1,args=arguments,len=args.length,str=String(f).replace(formatRegExp,function(x){if("%%"===x)return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}),x=args[i];len>i;x=args[++i])str+=isNull(x)||!isObject(x)?" "+x:" "+inspect(x);return str},exports.deprecate=function(fn,msg){function deprecated(){if(!warned){if(process.throwDeprecation)throw new Error(msg);process.traceDeprecation?console.trace(msg):console.error(msg),warned=!0}return fn.apply(this,arguments)}if(isUndefined(global.process))return function(){return exports.deprecate(fn,msg).apply(this,arguments)};if(process.noDeprecation===!0)return fn;var warned=!1;return deprecated};var debugEnviron,debugs={};exports.debuglog=function(set){if(isUndefined(debugEnviron)&&(debugEnviron=process.env.NODE_DEBUG||""),set=set.toUpperCase(),!debugs[set])if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else debugs[set]=function(){};return debugs[set]},exports.inspect=inspect,inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"},exports.isArray=isArray,exports.isBoolean=isBoolean,exports.isNull=isNull,exports.isNullOrUndefined=isNullOrUndefined,exports.isNumber=isNumber,exports.isString=isString,exports.isSymbol=isSymbol,exports.isUndefined=isUndefined,exports.isRegExp=isRegExp,exports.isObject=isObject,exports.isDate=isDate,exports.isError=isError,exports.isFunction=isFunction,exports.isPrimitive=isPrimitive,exports.isBuffer=require("./support/isBuffer");var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))},exports.inherits=require("inherits"),exports._extend=function(origin,add){if(!add||!isObject(add))return origin;for(var keys=Object.keys(add),i=keys.length;i--;)origin[keys[i]]=add[keys[i]];return origin}}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":5,_process:4,inherits:3}],7:[function(require,module){"use strict";function addDateConvenienceMethods(Date){"function"!=typeof Date.addYear&&(Date.addYear=function(){this.setFullYear(this.getFullYear()+1)},Date.addMonth=function(){this.setMonth(this.getMonth()+1)},Date.addDay=function(){this.setDate(this.getDate()+1)},Date.addHour=function(){this.setTime(this.getTime()+36e5)},Date.addMinute=function(){this.setTime(this.getTime()+6e4)},Date.addSecond=function(){this.setTime(this.getTime()+1e3)})}module.exports.addDateConvenienceMethods=addDateConvenienceMethods},{}],8:[function(require,module){(function(process){"use strict";function Job(name,job,callback){var pendingInvocations=[],jobName=name&&"string"==typeof name?name:"<Anonymous Job "+ ++anonJobCounter+">";this.job=name&&"function"==typeof name?name:job,this.callback=this.job===name?"function"==typeof job?job:!1:"function"==typeof callback?callback:!1,Object.defineProperty(this,"name",{value:jobName,writable:!1,enumerable:!0}),this.trackInvocation=function(invocation){return pendingInvocations.push(invocation),pendingInvocations.sort(sorter),!0},this.stopTrackingInvocation=function(invocation){var invIdx=pendingInvocations.indexOf(invocation);return invIdx>-1?(pendingInvocations.splice(invIdx,1),!0):!1},this.cancel=function(reschedule){reschedule="boolean"==typeof reschedule?reschedule:!1;for(var inv,newInv,newInvs=[],j=0;j<pendingInvocations.length;j++)inv=pendingInvocations[j],cancelInvocation(inv),reschedule&&inv.recurrenceRule.recurs&&(newInv=scheduleNextRecurrence(inv.recurrenceRule,this,inv.fireDate),null!==newInv&&newInvs.push(newInv));pendingInvocations=[];for(var k=0;k<newInvs.length;k++)this.trackInvocation(newInvs[k]);return reschedule||this.name&&(scheduledJobs[this.name]=null),!0},this.cancelNext=function(reschedule){if(reschedule="boolean"==typeof reschedule?reschedule:!0,!pendingInvocations.length)return!1;var newInv,nextInv=pendingInvocations.shift();return cancelInvocation(nextInv),reschedule&&nextInv.recurrenceRule.recurs&&(newInv=scheduleNextRecurrence(nextInv.recurrenceRule,this,nextInv.fireDate),null!==newInv&&this.trackInvocation(newInv)),!0},this.nextInvocation=function(){return pendingInvocations.length?pendingInvocations[0].fireDate:null},this.pendingInvocations=function(){return pendingInvocations}}function Invocation(job,fireDate,recurrenceRule){this.job=job,this.fireDate=fireDate,this.recurrenceRule=recurrenceRule||DoesntRecur,this.timerID=null}function sorter(a,b){return a.fireDate.getTime()-b.fireDate.getTime()}function Range(start,end,step){this.start=start||0,this.end=end||60,this.step=step||1}function RecurrenceRule(year,month,date,dayOfWeek,hour,minute,second){this.recurs=!0,this.year=null==year?null:year,this.month=null==month?null:month,this.date=null==date?null:date,this.dayOfWeek=null==dayOfWeek?null:dayOfWeek,this.hour=null==hour?null:hour,this.minute=null==minute?null:minute,this.second=null==second?0:second}function recurMatch(val,matcher){if(null==matcher)return!0;if("number"==typeof matcher||"string"==typeof matcher)return val===matcher;if(matcher instanceof Range)return matcher.contains(val);if(Array.isArray(matcher)||matcher instanceof Array)for(var i=0;i<matcher.length;i++)if(recurMatch(val,matcher[i]))return!0;return!1}function runOnDate(date,job){var now=(new Date).getTime(),then=date.getTime();return now>then?(process.nextTick(job),null):lt.setTimeout(job,then-now)}function scheduleInvocation(invocation){invocations.push(invocation),invocations.sort(sorter),prepareNextInvocation(),invocation.job.emit("scheduled",invocation.fireDate)}function prepareNextInvocation(){if(invocations.length>0&&currentInvocation!==invocations[0]){null!==currentInvocation&&(lt.clearTimeout(currentInvocation.timerID),currentInvocation.timerID=null,currentInvocation=null),currentInvocation=invocations[0];var job=currentInvocation.job,cinv=currentInvocation;currentInvocation.timerID=runOnDate(currentInvocation.fireDate,function(){if(currentInvocationFinished(),job.callback&&job.callback(),cinv.recurrenceRule.recurs||null===cinv.recurrenceRule._endDate){var inv=scheduleNextRecurrence(cinv.recurrenceRule,cinv.job,cinv.fireDate);null!==inv&&inv.job.trackInvocation(inv)}job.stopTrackingInvocation(cinv),job.invoke(),job.emit("run")})}}function currentInvocationFinished(){invocations.shift(),currentInvocation=null,prepareNextInvocation()}function cancelInvocation(invocation){var idx=invocations.indexOf(invocation);idx>-1&&(invocations.splice(idx,1),null!==invocation.timerID&&lt.clearTimeout(invocation.timerID),currentInvocation===invocation&&(currentInvocation=null),invocation.job.emit("canceled",invocation.fireDate),prepareNextInvocation())}function scheduleNextRecurrence(rule,job,prevDate){prevDate=prevDate instanceof Date?prevDate:new Date;var date=rule instanceof RecurrenceRule?rule.nextInvocationDate(prevDate):rule.next();if(null===date)return null;var inv=new Invocation(job,date,rule);return scheduleInvocation(inv),inv}function scheduleJob(){if(arguments.length<2)return null;var name=arguments.length>=3&&"string"==typeof arguments[0]?arguments[0]:null,spec=name?arguments[1]:arguments[0],method=name?arguments[2]:arguments[1],callback=name?arguments[3]:arguments[2],job=new Job(name,method,callback);return job.schedule(spec)?job:null}function cancelJob(job){var success=!1;return job instanceof Job?success=job.cancel():("string"==typeof job||job instanceof String)&&job in scheduledJobs&&scheduledJobs.hasOwnProperty(job)&&(success=scheduledJobs[job].cancel()),success}var events=require("events"),util=require("util"),increment=require("./increment.js"),cronParser=require("cron-parser"),lt=require("long-timeout"),anonJobCounter=0;util.inherits(Job,events.EventEmitter),Job.prototype.invoke=function(){"function"==typeof this.job?this.job():this.job.execute()},Job.prototype.runOnDate=function(date){return this.schedule(date)},Job.prototype.schedule=function(spec){var inv,self=this,success=!1;try{var res=cronParser.parseExpression(spec);inv=scheduleNextRecurrence(res,self),null!==inv&&(success=self.trackInvocation(inv))}catch(err){var type=typeof spec;if(("string"===type||"number"===type)&&(spec=new Date(spec)),spec instanceof Date)inv=new Invocation(self,spec),scheduleInvocation(inv),success=self.trackInvocation(inv);else if("object"===type){if(!(spec instanceof RecurrenceRule)){var r=new RecurrenceRule;"year"in spec&&(r.year=spec.year),"month"in spec&&(r.month=spec.month),"date"in spec&&(r.date=spec.date),"dayOfWeek"in spec&&(r.dayOfWeek=spec.dayOfWeek),"hour"in spec&&(r.hour=spec.hour),"minute"in spec&&(r.minute=spec.minute),"second"in spec&&(r.second=spec.second),spec=r}inv=scheduleNextRecurrence(spec,self),null!==inv&&(success=self.trackInvocation(inv))}}return scheduledJobs[this.name]=this,success};var DoesntRecur=new RecurrenceRule;DoesntRecur.recurs=!1,Range.prototype.contains=function(val){if(null===this.step||1===this.step)return val>=this.start&&val<=this.end;for(var i=this.start;i<this.end;i+=this.step)if(i===val)return!0;return!1},RecurrenceRule.prototype.nextInvocationDate=function(base){if(base=base instanceof Date?base:new Date,increment.addDateConvenienceMethods(base),!this.recurs)return null;var now=new Date;if(increment.addDateConvenienceMethods(now),null!==this.year&&"number"==typeof this.year&&this.year<now.getFullYear())return null;var next=new Date(base.getTime());for(increment.addDateConvenienceMethods(next),next.addSecond();;)if(null==this.year||recurMatch(next.getFullYear(),this.year))if(null==this.month||recurMatch(next.getMonth(),this.month))if(null==this.date||recurMatch(next.getDate(),this.date))if(null==this.dayOfWeek||recurMatch(next.getDay(),this.dayOfWeek))if(null==this.hour||recurMatch(next.getHours(),this.hour))if(null==this.minute||recurMatch(next.getMinutes(),this.minute)){if(null==this.second||recurMatch(next.getSeconds(),this.second))break;next.addSecond()}else next.addMinute();else next.addHour();else next.addDay();else next.addDay();else next.addMonth();else next.addYear(),next.setMonth(0),next.setDate(1),next.setHours(0),next.setMinutes(0),next.setSeconds(0);return next};var invocations=[],currentInvocation=null,scheduledJobs={};module.exports.Job=Job,module.exports.Range=Range,module.exports.RecurrenceRule=RecurrenceRule,module.exports.Invocation=Invocation,module.exports.scheduleJob=scheduleJob,module.exports.scheduledJobs=scheduledJobs,module.exports.cancelJob=cancelJob,module.exports.addDateConvenienceMethods=increment.addDateConvenienceMethods}).call(this,require("_process"))},{"./increment.js":7,_process:4,"cron-parser":11,events:2,"long-timeout":12,util:6}],9:[function(){"use strict";Date.prototype.addYear=function(){this.setFullYear(this.getFullYear()+1)},Date.prototype.addMonth=function(){this.setDate(1),this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMonth(this.getMonth()+1)},Date.prototype.addDay=function(){var day=this.getDate();this.setDate(day+1),this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.getDate()===day&&this.setDate(day+2)},Date.prototype.addHour=function(){var hours=this.getHours();this.setHours(hours+1),this.getHours()===hours&&this.setHours(hours+2),this.setMinutes(0),this.setSeconds(0)},Date.prototype.addMinute=function(){this.setMinutes(this.getMinutes()+1),this.setSeconds(0)},Date.prototype.addSecond=function(){this.setSeconds(this.getSeconds()+1)}},{}],10:[function(require,module){"use strict";function CronExpression(fields,options){this._options=options,this._currentDate=new Date(options.currentDate),this._endDate=options.endDate?new Date(options.endDate):null,this._fields={},this._isIterator=options.iterator||!1;for(var i=0,c=CronExpression.map.length;c>i;i++){var key=CronExpression.map[i];this._fields[key]=fields[i]}}require("./date"),CronExpression.map=["second","minute","hour","dayOfMonth","month","dayOfWeek"],CronExpression.predefined={"@yearly":"0 0 1 1 *","@monthly":"0 0 1 * *","@weekly":"0 0 * * 0","@daily":"0 0 * * *","@hourly":"0 * * * *"},CronExpression.constraints=[[0,59],[0,59],[0,23],[1,31],[1,12],[0,7]],CronExpression.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31],CronExpression.aliases={month:{jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12},dayOfWeek:{sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6}},CronExpression.parseDefaults=["0","*","*","*","*","*"],CronExpression._parseField=function(field,value,constraints){function parseSequence(val){function handleResult(result){var max=stack.length>0?Math.max.apply(Math,stack):-1;if(result instanceof Array)for(var i=0,c=result.length;c>i;i++){var value=result[i];if(value<constraints[0]||value>constraints[1])throw new Error("Constraint error, got value "+value+" expected range "+constraints[0]+"-"+constraints[1]);value>max&&stack.push(value),max=Math.max.apply(Math,stack)}else{if(result=+result,result<constraints[0]||result>constraints[1])throw new Error("Constraint error, got value "+result+" expected range "+constraints[0]+"-"+constraints[1]);"dayOfWeek"==field&&(result%=7),result>max&&stack.push(result)}}var stack=[],atoms=val.split(",");if(atoms.length>1)for(var i=0,c=atoms.length;c>i;i++)handleResult(parseRepeat(atoms[i]));else handleResult(parseRepeat(val));return stack}function parseRepeat(val){var repeatInterval=1,atoms=val.split("/");return atoms.length>1?parseRange(atoms[0],atoms[atoms.length-1]):parseRange(val,repeatInterval)}function parseRange(val,repeatInterval){var stack=[],atoms=val.split("-");if(atoms.length>1){if(atoms.length<2||!atoms[0].length)return+val;var min=+atoms[0],max=+atoms[1];if(Number.isNaN(min)||Number.isNaN(max)||min<constraints[0]||max>constraints[1])throw new Error("Constraint error, got range "+min+"-"+max+" expected range "+constraints[0]+"-"+constraints[1]);if(min>=max)throw new Error("Invalid range: "+val);for(var repeatIndex=repeatInterval,index=min,count=max;count>=index;index++)repeatIndex>0&&repeatIndex%repeatInterval===0?(repeatIndex=1,stack.push(index)):repeatIndex++;return stack}return+val}switch(field){case"month":case"dayOfWeek":var aliases=CronExpression.aliases[field];value=value.replace(/[a-z]{1,3}/gi,function(match){if(match=match.toLowerCase(),aliases[match])return aliases[match];throw new Error('Cannot resolve alias "'+match+'"')})}if(!/^[\d|\/|*|\-|,]+$/.test(value))throw new Error("Invalid characters, got value: "+value);return-1!==value.indexOf("*")&&(value=value.replace(/\*/g,constraints.join("-"))),parseSequence(value)},CronExpression.prototype._findSchedule=function(){function matchSchedule(value,sequence){for(var i=0,c=sequence.length;c>i;i++)if(sequence[i]>=value)return sequence[i]===value;return sequence[0]===value}function isWildcardRange(range,constraints){return range instanceof Array&&!range.length?!1:2!==constraints.length?!1:range.length===constraints[1]-(constraints[0]<1?-1:0)}for(var currentDate=new Date(this._currentDate),endDate=this._endDate;;){if(endDate&&endDate.getTime()-currentDate.getTime()<0)throw new Error("Out of the timespan range");var dayOfMonthMatch=matchSchedule(currentDate.getDate(),this._fields.dayOfMonth),dayOfWeekMatch=matchSchedule(currentDate.getDay(),this._fields.dayOfWeek),isDayOfMonthWildcardMatch=isWildcardRange(this._fields.dayOfMonth,CronExpression.constraints[3]),isMonthWildcardMatch=isWildcardRange(this._fields.dayOfWeek,CronExpression.constraints[4]),isDayOfWeekWildcardMatch=isWildcardRange(this._fields.dayOfWeek,CronExpression.constraints[5]);if(!isMonthWildcardMatch){var currentYear=currentDate.getYear(),currentMonth=currentDate.getMonth()+1,previousMonth=1===currentMonth?11:currentMonth-1,daysInPreviousMonth=CronExpression.daysInMonth[previousMonth-1],daysOfMontRangeMax=this._fields.dayOfMonth[this._fields.dayOfMonth.length-1],isLeap=!(currentYear%4||!(currentYear%100)&&currentYear%400);if(isLeap&&(daysInPreviousMonth=29),this._fields.month[0]===previousMonth&&daysOfMontRangeMax>daysInPreviousMonth)throw new Error("Invalid explicit day of month definition")}if(isDayOfMonthWildcardMatch||!isDayOfWeekWildcardMatch||dayOfMonthMatch)if(!isDayOfMonthWildcardMatch||isDayOfWeekWildcardMatch||dayOfWeekMatch)if(isDayOfMonthWildcardMatch&&isDayOfWeekWildcardMatch||dayOfMonthMatch||dayOfWeekMatch)if(matchSchedule(currentDate.getMonth()+1,this._fields.month))if(matchSchedule(currentDate.getHours(),this._fields.hour))if(matchSchedule(currentDate.getMinutes(),this._fields.minute)){if(matchSchedule(currentDate.getSeconds(),this._fields.second))break;currentDate.addSecond()}else currentDate.addMinute();else currentDate.addHour();else currentDate.addMonth();else currentDate.addDay();else currentDate.addDay();else currentDate.addDay()}var nextDate=new Date(currentDate);return this._currentDate!==currentDate&&nextDate.addSecond(),this._currentDate=nextDate,currentDate},CronExpression.prototype.next=function(){var schedule=this._findSchedule();return this._isIterator?{value:schedule,done:!this.hasNext()}:schedule},CronExpression.prototype.hasNext=function(){var current=this._currentDate;try{return this.next(),!0}catch(err){return!1}finally{this._currentDate=current}},CronExpression.prototype.iterate=function(steps,callback){for(var dates=[],i=0,c=steps;c>i;i++)try{var item=this.next();dates.push(item),callback&&callback(item,i)}catch(err){break}return dates},CronExpression.prototype.reset=function(){this._currentDate=new Date(this._options.currentDate)},CronExpression.parse=function parse(expression,options,callback){function parse(expression,options){options||(options={}),options.currentDate||(options.currentDate=new Date),CronExpression.predefined[expression]&&(expression=CronExpression.predefined[expression]);for(var fields=[],atoms=expression.split(" "),start=CronExpression.map.length-atoms.length,i=0,c=CronExpression.map.length;c>i;++i){var field=CronExpression.map[i],value=atoms[atoms.length>c?i:i-start];fields.push(start>i||!value?CronExpression._parseField(field,CronExpression.parseDefaults[i],CronExpression.constraints[i]):CronExpression._parseField(field,value,CronExpression.constraints[i]))}return new CronExpression(fields,options)}return"function"==typeof options&&(callback=options,
options={}),parse(expression,options)},module.exports=CronExpression},{"./date":9}],11:[function(require,module){"use strict";function CronParser(){}var CronExpression=require("./expression");CronParser._parseEntry=function(entry){var atoms=entry.split(" ");if(6===atoms.length)return{interval:CronExpression.parse(entry)};if(atoms.length>6)return{interval:CronExpression.parse(entry),command:atoms.slice(6,atoms.length)};throw new Error("Invalid entry: "+entry)},CronParser.parseExpression=function(expression,options,callback){return CronExpression.parse(expression,options,callback)},CronParser.parseString=function(data){for(var self=this,blocks=data.split("\n"),response={variables:{},expressions:[],errors:{}},i=0,c=blocks.length;c>i;i++){var block=blocks[i],matches=null,entry=block.replace(/^\s+|\s+$/g,"");if(entry.length>0){if(entry.match(/^#/))continue;if(matches=entry.match(/^(.*)=(.*)$/))response.variables[matches[1]]=matches[2];else{var result=null;try{result=self._parseEntry("0 "+entry),response.expressions.push(result.interval)}catch(err){response.errors[entry]=err}}}}return response},CronParser.parseFile=function(filePath,callback){require("fs").readFile(filePath,function(err,data){return err?void callback(err):callback(null,CronParser.parseString(data.toString()))})},module.exports=CronParser},{"./expression":10,fs:1}],12:[function(require,module,exports){function Timeout(listener,after){this.listener=listener,this.after=after,this.start()}var TIMEOUT_MAX=2147483647;exports.setTimeout=function(listener,after){return new Timeout(listener,after)},exports.clearTimeout=function(timer){timer&&timer.close()},exports.Timeout=Timeout,Timeout.prototype.start=function(){if(this.after<=TIMEOUT_MAX)this.timeout=setTimeout(this.listener,this.after);else{var self=this;this.timeout=setTimeout(function(){self.after-=TIMEOUT_MAX,self.start()},TIMEOUT_MAX)}},Timeout.prototype.close=function(){clearTimeout(this.timeout)}},{}],13:[function(require,module){"use strict";function Microphone(_options){var options=_options||{};this.bufferSize=options.bufferSize||8192,this.inputChannels=options.inputChannels||1,this.outputChannels=options.outputChannels||1,this.recording=!1,this.requestedAccess=!1,this.sampleRate=16e3,this.bufferUnusedSamples=new Float32Array(0),navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}var utils=require("./utils");Microphone.prototype.onPermissionRejected=function(){console.log("Microphone.onPermissionRejected()"),this.requestedAccess=!1,this.onError("Permission to access the microphone rejeted.")},Microphone.prototype.onError=function(error){console.log("Microphone.onError():",error)},Microphone.prototype.pauseRecording=function(){this.recording=!1},Microphone.prototype.restartRecording=function(){this.recording=!0},Microphone.prototype.onMediaStream=function(stream){var AudioCtx=window.AudioContext||window.webkitAudioContext;if(!AudioCtx)throw new Error("AudioContext not available");this.audioContext||(this.audioContext=new AudioCtx);var gain=this.audioContext.createGain(),audioInput=this.audioContext.createMediaStreamSource(stream);audioInput.connect(gain),this.mic=this.audioContext.createScriptProcessor(this.bufferSize,this.inputChannels,this.outputChannels),console.log("Microphone.onMediaStream(): sampling rate is:",this.sampleRate),this.mic.onaudioprocess=this._onaudioprocess.bind(this),this.stream=stream,gain.connect(this.mic),this.mic.connect(this.audioContext.destination),this.recording=!0,this.requestedAccess=!1,this.onStartRecording()},Microphone.prototype._onaudioprocess=function(data){if(this.recording){var chan=data.inputBuffer.getChannelData(0);this.onAudio(this._exportDataBufferTo16Khz(new Float32Array(chan)))}},Microphone.prototype.record=function(){return navigator.getUserMedia?void(this.requestedAccess||(this.requestedAccess=!0,navigator.getUserMedia({audio:!0},this.onMediaStream.bind(this),this.onPermissionRejected.bind(this)))):void this.onError("Browser doesn't support microphone input")},Microphone.prototype.stop=function(){this.recording&&(this.recording=!1,this.stream.getTracks()[0].stop(),this.requestedAccess=!1,this.mic.disconnect(0),this.mic=null,this.onStopRecording())},Microphone.prototype._exportDataBufferTo16Khz=function(bufferNewSamples){var buffer=null,newSamples=bufferNewSamples.length,unusedSamples=this.bufferUnusedSamples.length;if(unusedSamples>0){buffer=new Float32Array(unusedSamples+newSamples);for(var i=0;unusedSamples>i;++i)buffer[i]=this.bufferUnusedSamples[i];for(i=0;newSamples>i;++i)buffer[unusedSamples+i]=bufferNewSamples[i]}else buffer=bufferNewSamples;for(var filter=[-.037935,-89024e-8,.040173,.019989,.0047792,-.058675,-.056487,-.0040653,.14527,.26927,.33913,.26927,.14527,-.0040653,-.056487,-.058675,.0047792,.019989,.040173,-89024e-8,-.037935],samplingRateRatio=this.audioContext.sampleRate/16e3,nOutputSamples=Math.floor((buffer.length-filter.length)/samplingRateRatio)+1,pcmEncodedBuffer16k=new ArrayBuffer(2*nOutputSamples),dataView16k=new DataView(pcmEncodedBuffer16k),index=0,volume=32767,nOut=0,i=0;i+filter.length-1<buffer.length;i=Math.round(samplingRateRatio*nOut)){for(var sample=0,j=0;j<filter.length;++j)sample+=buffer[i+j]*filter[j];sample*=volume,dataView16k.setInt16(index,sample,!0),index+=2,nOut++}var indexSampleAfterLastUsed=Math.round(samplingRateRatio*nOut),remaining=buffer.length-indexSampleAfterLastUsed;if(remaining>0)for(this.bufferUnusedSamples=new Float32Array(remaining),i=0;remaining>i;++i)this.bufferUnusedSamples[i]=buffer[indexSampleAfterLastUsed+i];else this.bufferUnusedSamples=new Float32Array(0);return new Blob([dataView16k],{type:"audio/l16"})};Microphone.prototype._exportDataBuffer=function(buffer){utils.exportDataBuffer(buffer,this.bufferSize)},Microphone.prototype.onStartRecording=function(){},Microphone.prototype.onStopRecording=function(){},Microphone.prototype.onAudio=function(){},module.exports=Microphone},{"./utils":20}],14:[function(require,module){module.exports={models:[{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/en-US_BroadbandModel",rate:16e3,name:"en-US_BroadbandModel",language:"en-US",description:"US English broadband model (16KHz)"},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/en-US_NarrowbandModel",rate:8e3,name:"en-US_NarrowbandModel",language:"en-US",description:"US English narrowband model (8KHz)"},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/es-ES_BroadbandModel",rate:16e3,name:"es-ES_BroadbandModel",language:"es-ES",description:"Spanish broadband model (16KHz)"},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/es-ES_NarrowbandModel",rate:8e3,name:"es-ES_NarrowbandModel",language:"es-ES",description:"Spanish narrowband model (8KHz)"},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/pt-BR_BroadbandModel",rate:16e3,name:"pt-BR_BroadbandModel",language:"pt-BR",description:"Brazilian Portuguese broadband model (16KHz)"},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/pt-BR_NarrowbandModel",rate:8e3,name:"pt-BR_NarrowbandModel",language:"pt-BR",description:"Brazilian Portuguese narrowband model (8KHz)"},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/zh-CN_BroadbandModel",rate:16e3,name:"zh-CN_BroadbandModel",language:"zh-CN",description:"Mandarin broadband model (16KHz)"},{url:"https://stream.watsonplatform.net/speech-to-text/api/v1/models/zh-CN_NarrowbandModel",rate:8e3,name:"zh-CN_NarrowbandModel",language:"zh-CN",description:"Mandarin narrowband model (8KHz)"}]}},{}],15:[function(require,module,exports){"use strict";var display=require("./views/displaymetadata"),initSocket=require("./socket").initSocket;exports.handleFileUpload=function(type,token,model,file,contentType,callback,onend){function onOpen(){console.log("Socket opened")}function onListening(socket){console.log("Socket listening"),callback(socket)}function onMessage(msg){msg.results&&(baseString=display.showResult(msg,baseString,model),baseJSON=display.showJSON(msg,baseJSON))}function onError(evt){localStorage.setItem("currentlyDisplaying","false"),onend(evt),console.log("Socket err: ",evt.code)}function onClose(evt){localStorage.setItem("currentlyDisplaying","false"),onend(evt),console.log("Socket closing: ",evt)}localStorage.setItem("currentlyDisplaying",type),$.subscribe("progress",function(evt,data){console.log("progress: ",data)}),console.log("contentType",contentType);var baseString="",baseJSON="";$.subscribe("showjson",function(){var $resultsJSON=$("#resultsJSON");$resultsJSON.empty(),$resultsJSON.append(baseJSON)});var options={};options.token=token,options.message={action:"start","content-type":contentType,interim_results:!0,continuous:!0,word_confidence:!0,timestamps:!0,max_alternatives:3,inactivity_timeout:600},options.model=model,initSocket(options,onOpen,onListening,onMessage,onError,onClose)}},{"./socket":19,"./views/displaymetadata":22}],16:[function(require,module,exports){"use strict";var initSocket=require("./socket").initSocket,display=require("./views/displaymetadata");exports.handleMicrophone=function(token,model,mic,callback){function onOpen(socket){console.log("Mic socket: opened"),callback(null,socket)}function onListening(socket){mic.onAudio=function(blob){socket.readyState<2&&socket.send(blob)}}function onMessage(msg){msg.results&&(baseString=display.showResult(msg,baseString,model),baseJSON=display.showJSON(msg,baseJSON))}function onError(){console.log("Mic socket err: ",err)}function onClose(evt){console.log("Mic socket close: ",evt)}if(model.indexOf("Narrowband")>-1){var err=new Error("Microphone transcription cannot accomodate narrowband models, please select another");return callback(err,null),!1}$.publish("clearscreen");var baseString="",baseJSON="";$.subscribe("showjson",function(){var $resultsJSON=$("#resultsJSON");$resultsJSON.empty(),$resultsJSON.append(baseJSON)});var options={};options.token=token,options.message={action:"start","content-type":"audio/l16;rate=16000",interim_results:!0,continuous:!0,word_confidence:!0,timestamps:!0,max_alternatives:3,inactivity_timeout:600},options.model=model,initSocket(options,onOpen,onListening,onMessage,onError,onClose)}},{"./socket":19,"./views/displaymetadata":22}],17:[function(require){"use strict";var models=require("./data/models.json").models,utils=require("./utils");utils.initPubSub();var initViews=require("./views").initViews,showerror=require("./views/showerror"),showError=showerror.showError,getModels=require("./models").getModels;window.BUFFERSIZE=8192,$(document).ready(function(){var tokenGenerator=utils.createTokenGenerator();tokenGenerator.getToken(function(err,token){window.onbeforeunload=function(){localStorage.clear()},token||(console.error("No authorization token available"),console.error("Attempting to reconnect..."),showError(err&&err.code?"Server error "+err.code+": "+err.error:"Server error "+err.code+": please refresh your browser and try again"));var viewContext={currentModel:"en-US_BroadbandModel",models:models,token:token,bufferSize:BUFFERSIZE};initViews(viewContext),localStorage.setItem("models",JSON.stringify(models)),localStorage.setItem("currentModel","en-US_BroadbandModel"),localStorage.setItem("sessionPermissions","true"),getModels(token),$.subscribe("clearscreen",function(){$("#resultsText").text(""),$("#resultsJSON").text(""),$(".error-row").hide(),$(".notification-row").hide(),$(".hypotheses > ul").empty(),$("#metadataTableBody").empty()})})})},{"./data/models.json":14,"./models":18,"./utils":20,"./views":26,"./views/showerror":32}],18:[function(require,module,exports){"use strict";var selectModel=require("./views/selectmodel").initSelectModel;exports.getModels=function(token){var viewContext={currentModel:"en-US_BroadbandModel",models:null,token:token,bufferSize:BUFFERSIZE},modelUrl="https://stream.watsonplatform.net/speech-to-text/api/v1/models",sttRequest=new XMLHttpRequest;sttRequest.open("GET",modelUrl,!0),sttRequest.withCredentials=!0,sttRequest.setRequestHeader("Accept","application/json"),sttRequest.setRequestHeader("X-Watson-Authorization-Token",token),sttRequest.onload=function(){var response=JSON.parse(sttRequest.responseText),sorted=response.models.sort(function(a,b){return a.name>b.name?1:a.name<b.name?-1:0});response.models=sorted,localStorage.setItem("models",JSON.stringify(response.models)),viewContext.models=response.models,selectModel(viewContext)},sttRequest.onerror=function(){viewContext.models=require("./data/models.json").models,selectModel(viewContext)},sttRequest.send()}},{"./data/models.json":14,"./views/selectmodel":30}],19:[function(require,module,exports){"use strict";var utils=require("./utils"),showerror=require("./views/showerror"),showError=showerror.showError,tokenGenerator=utils.createTokenGenerator(),initSocket=exports.initSocket=function(options,onopen,onlistening,onmessage,onerror,onclose){function withDefault(val,defaultVal){return"undefined"==typeof val?defaultVal:val}var listening,socket,token=options.token,model=options.model||localStorage.getItem("currentModel"),message=options.message||{action:"start"},sessionPermissions=withDefault(options.sessionPermissions,JSON.parse(localStorage.getItem("sessionPermissions"))),sessionPermissionsQueryParam=sessionPermissions?"0":"1",url=options.serviceURI||"wss://stream.watsonplatform.net/speech-to-text/api/v1/recognize?watson-token=";url+=token+"&X-WDC-PL-OPT-OUT="+sessionPermissionsQueryParam+"&model="+model,console.log("URL model",model);try{socket=new WebSocket(url)}catch(err){console.error("WS connection error: ",err)}socket.onopen=function(){listening=!1,$.subscribe("hardsocketstop",function(){console.log("MICROPHONE: close."),socket.send(JSON.stringify({action:"stop"})),socket.close()}),$.subscribe("socketstop",function(){console.log("MICROPHONE: close."),socket.close()}),socket.send(JSON.stringify(message)),onopen(socket)},socket.onmessage=function(evt){var msg=JSON.parse(evt.data);return msg.error?(showError(msg.error),void $.publish("hardsocketstop")):("listening"===msg.state&&(listening?(console.log("MICROPHONE: Closing socket."),socket.close()):(onlistening(socket),listening=!0)),void onmessage(msg,socket))},socket.onerror=function(evt){console.log("WS onerror: ",evt),showError("Application error "+evt.code+": please refresh your browser and try again"),$.publish("clearscreen"),onerror(evt)},socket.onclose=function(evt){if(console.log("WS onclose: ",evt),1006===evt.code){if(console.log("generator count",tokenGenerator.getCount()),tokenGenerator.getCount()>1)throw $.publish("hardsocketstop"),new Error("No authorization token is currently available");return tokenGenerator.getToken(function(err,token){return err?($.publish("hardsocketstop"),!1):(console.log("Fetching additional token..."),options.token=token,void initSocket(options,onopen,onlistening,onmessage,onerror,onclose))}),!1}return 1011===evt.code?(console.error("Server error "+evt.code+": please refresh your browser and try again"),!1):evt.code>1e3?(console.error("Server error "+evt.code+": please refresh your browser and try again"),!1):($.unsubscribe("hardsocketstop"),$.unsubscribe("socketstop"),void onclose(evt))}}},{"./utils":20,"./views/showerror":32}],20:[function(require,module,exports){(function(global){"use strict";var $="undefined"!=typeof window?window.jQuery:"undefined"!=typeof global?global.jQuery:null,fileBlock=function(_offset,length,_file,readChunk){var r=new FileReader,blob=_file.slice(_offset,length+_offset);r.onload=readChunk,r.readAsArrayBuffer(blob)};exports.onFileProgress=function(options,ondata,running,onerror,onend,samplingRate){var file=options.file,fileSize=file.size,chunkSize=options.bufferSize||16e3,offset=0,readChunk=function(evt){if(offset>=fileSize)return console.log("Done reading file"),void onend();if(running()){if(null!=evt.target.error){var errorMessage=evt.target.error;return console.log("Read error: "+errorMessage),void onerror(errorMessage)}var buffer=evt.target.result,len=buffer.byteLength;offset+=len,ondata(buffer),samplingRate?setTimeout(function(){fileBlock(offset,chunkSize,file,readChunk)},1e3*chunkSize/(2*samplingRate)):fileBlock(offset,chunkSize,file,readChunk)}};fileBlock(offset,chunkSize,file,readChunk)},exports.createTokenGenerator=function(){var hasBeenRunTimes=0;return{getToken:function(callback){if(++hasBeenRunTimes,hasBeenRunTimes>5){var err=new Error("Cannot reach server");return void callback(null,err)}var url="/api/token",tokenRequest=new XMLHttpRequest;tokenRequest.open("POST",url,!0),tokenRequest.setRequestHeader("csrf-token",$('meta[name="ct"]').attr("content")),tokenRequest.onreadystatechange=function(){if(4===tokenRequest.readyState)if(200===tokenRequest.status){var token=tokenRequest.responseText;callback(null,token)}else{var error="Cannot reach server";if(tokenRequest.responseText)try{error=JSON.parse(tokenRequest.responseText)}catch(e){error=tokenRequest.responseText}callback(error)}},tokenRequest.send()},getCount:function(){return hasBeenRunTimes}}},exports.initPubSub=function(){var o=$({});$.subscribe=o.on.bind(o),$.unsubscribe=o.off.bind(o),$.publish=o.trigger.bind(o)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],21:[function(require,module,exports){"use strict";exports.initAnimatePanel=function(){$(".panel-heading span.clickable").on("click",function(){$(this).hasClass("panel-collapsed")?($(this).parents(".panel").find(".panel-body").slideDown(),$(this).removeClass("panel-collapsed"),$(this).find("i").removeClass("caret-down").addClass("caret-up")):($(this).parents(".panel").find(".panel-body").slideUp(),$(this).addClass("panel-collapsed"),$(this).find("i").removeClass("caret-up").addClass("caret-down"))})}},{}],22:[function(require,module,exports){"use strict";function updateTextScroll(){if(!scrolled){var element=$("#resultsText").get(0);element.scrollTop=element.scrollHeight}}function playOnly(text){console.log("Translation = "+text);var micOptions={bufferSize:8192},Microphone=require("../Microphone"),mic=new Microphone(micOptions);mic.pauseRecording();var utteranceOptions={text:text,voice:voice,sessionPermissions:1};synthesizeRequest(utteranceOptions,audio),mic.restartRecording()}function synthesizeRequest(options,audio){var downloadURL="/api/synthesize?voice="+options.voice+"&text="+encodeURIComponent(options.text)+"&X-WDC-PL-OPT-OUT="+options.sessionPermissions;if(options.download)return downloadURL+="&download=true",window.location.href=downloadURL,!0;audio.pause();try{audio.currentTime=0}catch(ex){}return audio.src=downloadURL,audio.play(),!0}function playText(text){switch(lastThingISaid=text.replace(".","").toLowerCase(),voice){case"es-ES_EnriqueVoice":translateText(text,"en","es",playOnly);break;case"fr-FR_ReneeVoice":translateText(text,"en","fr",playOnly);break;case"de-DE_DieterVoice":case"de-DE_BirgitVoice":translateText(text,"en","de",playOnly);break;default:playOnly(text)}}function translateText(textContent,source,target,callback){var callData={text:textContent,source:source,target:target},restAPICall={type:"POST",url:"/api/translate",data:callData,headers:{"X-WDC-PL-OPT-OUT":1},async:!0};$.ajax(restAPICall).done(function(data){console.log("translation = "+data.translations[0].translation),callback(data.translations[0].translation)}).fail(function(jqXHR,statustext,errorthrown){console.log("translateText(): "+statustext+" - "+errorthrown)})}function analyzeSymptoms(){return".....It sounds like you have a common cold. Take 2 aspirin and get rest"}function mathResult(text,type){text=text.substring(0,text.length-2);for(var result=text.split(" "),x=0;x<result.length;x++)if(result[x]===type){var firstNumber=getNumberBefore(result,x);console.log("first number = "+firstNumber),console.log(text2num(firstNumber));var secondNumber=getNumberAfter(result,x);switch(console.log("second number = "+secondNumber),console.log(text2num(secondNumber)),type){case"plus":var sum=text2num(firstNumber)+text2num(secondNumber);break;case"minus":var sum=text2num(firstNumber)-text2num(secondNumber);break;case"times":var sum=text2num(firstNumber)*text2num(secondNumber);break;case"dividedby":var sum=text2num(firstNumber)/text2num(secondNumber)}return console.log(sum),sum}}function getNumberBefore(result,x){var numstr="",results=[];for(x--;x>=0;)"to"===result[x]&&(result[x]="two"),(Small[result[x].toLowerCase()]>=0||Magnitude[result[x].toLowerCase()]>=0)&&results.push(result[x]),x--;for(var z=results.length-1;z>=0;z--)numstr+=results[z]+" ";return numstr.trim()}function getNumberAfter(result,x){var numstr="",results=[];for(x++;x<result.length;)(Small[result[x].toLowerCase()]>=0||Magnitude[result[x].toLowerCase()]>=0)&&results.push(result[x]),x++;for(var z=0;z<results.length;z++)numstr+=results[z]+" ";return numstr.trim()}function getDateTime(){var date=new Date,hour=date.getHours(),ampm="A.M.";hour>12&&(hour-=12,ampm="P.M.");var min=date.getMinutes(),sec=date.getSeconds();sec=(10>sec?"0":"")+sec;date.getFullYear(),date.getMonth()+1,date.getDate();return console.log(hour+" "+min),hour+" "+min+" "+ampm}function getDate(){var date=new Date,year=date.getFullYear(),month=getMonthString(date.getMonth()+1),day=date.getDate();return month+" "+day+", "+year}function getMonthString(month){switch(month){case 1:return"January";case 2:return"February";case 3:return"March";case 4:return"April";case 5:return"May";case 6:return"June";case 7:return"July";case 8:return"August";case 9:return"September";case 10:return"October";case 11:return"November";case 12:return"December"}}function text2num(s){return s=s.toLowerCase(),a=s.toString().split(/[\s-]+/),n=0,g=0,console.log("a = "+a),a.forEach(feach),console.log("n = "+n),console.log("g = "+g),n+g}function feach(w){var x=Small[w];null!=x?g+=x:"hundred"===w?g=100*g:(x=Magnitude[w],null!=x?(n+=g*x,g=0):alert("Unknown number: "+w))}var responseCounter=0,responses=["Hello. Is anybody there?","Andrew?","Ryan?","Rosa?","Anybody at all"];$(document).bind("idle.idleTimer",function(){console.log("User Idle"),responseCounter++,responseCounter>=responses.length&&(responseCounter=0)}),$(document).bind("active.idleTimer",function(){console.log("User Active")});var scrolled=!1,textScrolled=!1,showTimestamp=function(timestamps,confidences){var word=timestamps[0],t0=timestamps[1],t1=timestamps[2],displayConfidence=confidences?confidences[1].toString().substring(0,3):"n/a";$("#metadataTable > tbody:last-child").append("<tr><td>"+word+"</td><td>"+t0+"</td><td>"+t1+"</td><td>"+displayConfidence+"</td></tr>")},showMetaData=function(alternative){var confidenceNestedArray=alternative.word_confidence,timestampNestedArray=alternative.timestamps;if(confidenceNestedArray&&confidenceNestedArray.length>0)for(var i=0;i<confidenceNestedArray.length;i++){var timestamps=timestampNestedArray[i],confidences=confidenceNestedArray[i];showTimestamp(timestamps,confidences)}else timestampNestedArray&&timestampNestedArray.length>0&&timestampNestedArray.forEach(function(timestamp){showTimestamp(timestamp)})},Alternatives=function(){var stringOne="",stringTwo="",stringThree="";this.clearString=function(){stringOne="",stringTwo="",stringThree=""},this.showAlternatives=function(alternatives){var $hypotheses=$(".hypotheses ol");$hypotheses.empty(),alternatives.forEach(function(alternative,idx){var $alternative;if(alternative.transcript){var transcript=alternative.transcript.replace(/%HESITATION\s/g,"");switch(transcript=transcript.replace(/(.)\1{2,}/g,""),idx){case 0:stringOne+=transcript,$alternative=$("<li data-hypothesis-index="+idx+" >"+stringOne+"</li>");break;case 1:stringTwo+=transcript,$alternative=$("<li data-hypothesis-index="+idx+" >"+stringTwo+"</li>");break;case 2:stringThree+=transcript,$alternative=$("<li data-hypothesis-index="+idx+" >"+stringThree+"</li>")}$hypotheses.append($alternative)}})}},alternativePrototype=new Alternatives;exports.showJSON=function(msg,baseJSON){var json=JSON.stringify(msg,null,2);return baseJSON+=json,baseJSON+="\n","JSON"===$(".nav-tabs .active").text()&&($("#resultsJSON").append(baseJSON),baseJSON="",console.log("updating json")),baseJSON};var initTextScroll=function(){$("#resultsText").on("scroll",function(){textScrolled=!0})};exports.initDisplayMetadata=function(){initTextScroll()};var voice="en-US_AllisonVoice";voice="en-US_MichaelVoice";var audio=$(".audio").get(0),lastThingISaid="",collectSymptoms=!1,symptoms=[],phrases=["Help me","Close help","Hi","Hello","Say hi","My name is {your name}","How do you talk so well","What do you do","Thank you","How are you","How are you doing","How's it going","What time is it","What day is it","What is X plus Y","What is X minus Y","Thank you","Where is the nearest hotel","Insurance example","Do you speak French","Do you speak Spanish","Do you speak English"];exports.showResult=function(msg,baseString){if(msg.results&&msg.results.length>0){var alternatives=msg.results[0].alternatives,text=msg.results[0].alternatives[0].transcript||"";if(text=text.replace(/%HESITATION\s/g,""),text=text.replace(/(.)\1{2,}/g,""),msg.results[0]["final"]&&console.log("-> "+text),text=text.replace(/D_[^\s]+/g,""),0===text.length||/^\s+$/.test(text))return baseString;if(msg.results&&msg.results[0]&&msg.results[0]["final"]){if(text=text.slice(0,-1),console.log("last thing I said: "+lastThingISaid),console.log("What I heard: "+text),lastThingISaid===text||text.indexOf(lastThingISaid)>=0&&lastThingISaid.length>0)return;if(text=text.charAt(0).toUpperCase()+text.substring(1),text=text.trim()+". ",console.log(text),collectSymptoms&&(symptoms.push(text),console.log(symptoms),symptoms.length>2&&(playText(analyzeSymptoms(symptoms)),collectSymptoms=!1,symptoms=[])),text.indexOf("Say hi")>=0)playText("Hi everybody. I am Bluemix.... Welcome to our demo today.  Hope you find it engaging.  Feel free to ask Kevin any questions during his presentation");else if((text.indexOf("Hello")>=0||text.indexOf("Hi")>=0)&&text.length<30){var responses=["How are you","Hi","Hello","How's it going","Hi I'm Bluemix.  What is your name?"],randomNumber=Math.round(Math.random()*responses.length)-1;console.log(randomNumber),console.log(Math.round(Math.random()*responses.length)),playText(responses[randomNumber])}else if(text.indexOf("My name is")>=0||text.indexOf("My name's")>=0){console.log(text.trim().lastIndexOf(" "));var name=text.trim().substring(text.trim().lastIndexOf(" "));console.log(name),playText("Nice to meet you "+name)}else if("How are you. "===text||"How you doing. "===text||"How are you doing. "===text){var responses=["Fine. How about yourself","Fine","Not too bad","Pretty good","Fine. How about you"],randomNumber=Math.round(Math.random()*responses.length);console.log(randomNumber),console.log(Math.round(Math.random()*responses.length)),playText(responses[randomNumber])}else if("How's it going. "===text)playText("Not bad, how about yourself");else if("What you doing. "===text||"What are you doing. "===text){var responses=["Talking with you","Just processing queries","Not much. What are you doing.","Watching TV","Sleeping"],randomNumber=Math.round(Math.random()*responses.length);console.log(randomNumber),console.log(Math.round(Math.random()*responses.length)),playText(responses[randomNumber])}else if("Watching TV. "===text)playText("What are you watching");else if("Eating dinner. "===text)playText("What's for dinner");else if("Clear. "===text)baseString="",text="";else if("Spanish language. "===text||"Do you speak Spanish. "===text||"Do you speak in Spanish. "===text||"Please speak Spanish. "===text||"Please speak in Spanish. "===text||"You speak Spanish. "===text)voice="es-ES_EnriqueVoice",playText("Yes");else if("French language. "===text||"Do you speak French. "===text||"Do you speak in French. "===text||"Please speak French. "===text||"Please speak in French. "===text||"You speak French. "===text)voice="fr-FR_ReneeVoice",playText("Yes");else if("German language. "===text)voice="de-DE_DieterVoice",voice="de-DE_BirgitVoice",playText("Do you speak German");else if("English language. "===text||"Do you speak English. "===text||"Do you speak in English. "===text||"Please speak English. "===text||"Please speak in English. "===text||"You speak English. "===text)voice="en-US_AllisonVoice",voice="en-US_MichaelVoice",playText("Absolutely");else if(text.indexOf("Do you speak ")>=0)voice="en-US_AllisonVoice",voice="en-US_MichaelVoice",playText("Unfortunately No, but I hope to speak it soon");else if("Insurance example. "===text)playText("......Please describe your symptoms"),collectSymptoms=!0;else if("Where is the nearest hotel. "===text||"What is the nearest hotel. "===text||"Where's the nearest hotel. "===text||"What's the nearest hotel. "===text)playText("There are three hotels within 5 miles from here. Would you like to book a stay?");else if("What's your name. "===text||"What is your name. "===text||"What your name. "===text)playText("Bluemix");else if(text.indexOf("What do you do")>=0||text.indexOf("What are you")>=0)playText("I am an open standards cloud platform to build cool applications");else if(text.indexOf("Is that fun")>=0||text.indexOf("Is it fun")>=0)playText("Yeah...it's a lot of fun. ");else if(text.indexOf("Open window")>=0||text.indexOf("Google something")>=0)window.open("http://www.google.com");else if(text.indexOf("Watch video")>=0||text.indexOf("Show video")>=0)window.open("https://www.youtube.com/watch?v=ny66mjQsVak");else if(text.indexOf("Open application")>=0||text.indexOf("Show application")>=0)window.open("http://iot-visualization-kad.mybluemix.net/dashboard");else if(text.indexOf("Hide demos")>=0||text.indexOf("Hide demo")>=0||text.indexOf("Hi demos")>=0||text.indexOf("I demos")>=0||text.indexOf("Clear demos")>=0||text.indexOf("No demos")>=0)$(".show_demos").empty(),$(".show_demos").css("visibility","hidden");else if(text.indexOf("Secret message")>=0);else if(text.indexOf("How do you talk so well")>=0||text.indexOf("How do you speak so well")>=0)playText("That's my buddy Watson in the background.  I record what you say, and Watson tells me how to speak back to you in your language. Watson also translates for me from English to Spanish to French");else if("Close help. "===text)$(".show_help").empty(),$(".show_help").css("visibility","hidden");else if("Help. "===text||"I need help. "===text||"Help me. "===text||"Show me help."===text||"Show help."===text){playText("Ask me a question like what time is it, or what's your name or what day is it or How are you. You can change my language by saying French Language or Spanish language or English. The following is a list of many of the commands you can say. Say Close Help to remove these instructions."),$(".show_help").css("visibility","visible");for(var phraseString="",z=0;z<phrases.length;z++)phraseString+="<tr><td>"+phrases[z]+"</td></tr>";$(".show_help").append('<H2>Help (say "Close help" to hide)</H2><table><tr><td><b>Phrases Supported</b></td></tr>'),$(".show_help").append(phraseString),$(".show_help").append("</table>")}else"What time is it. "===text?playText(getDateTime()):"What day is it. "===text||"What is today. "===text?playText(getDate()):"Is it cold outside. "===text?playText("Yes It is 50 degrees"):"Weather. "===text?playText("It is going to be a beautiful day"):"How does the weather look tomorrow. "===text?playText("It's going to be a nice day"):"Thank you. "===text||text.indexOf("thank you")>=0?playText("Your welcome"):"Goodbye. "===text?playText("Hope to hear from you soon"):text.indexOf("plus")>=0?playText(mathResult(text,"plus")+""):text.indexOf("minus")>=0?playText(mathResult(text,"minus")+""):text.indexOf("times")>=0?playText(mathResult(text,"times")+""):text.indexOf("divided by")>=0?(text=text.replace("divided by","dividedby"),playText(mathResult(text,"dividedby")+"")):text.indexOf("What")>=0||text.indexOf("How")>=0||text.indexOf("When")>=0||text.indexOf("Why")>=0;text=text.replace("Nnb.",""),text=text.replace("Nndb.",""),
text=text.replace("Nndb",""),text=text.replace("Nnnd.",""),text=text.replace("Nnb",""),text=text.replace("Nnj.",""),text=text.replace("Nnj",""),text=text.replace("nnj.",""),text=text.replace("nnj.",""),text=text.replace("dnmt",""),text=text.replace("ndmt.",""),baseString+=text,showMetaData(alternatives[0]),alternativePrototype.showAlternatives(alternatives)}else text=text.replace("Nnb.",""),text=text.replace("Nndb.",""),text=text.replace("Nndb",""),text=text.replace("Nnnd.",""),text=text.replace("Nnb",""),text=text.replace("Nnj.",""),text=text.replace("Nnj",""),text=text.replace("nnj.",""),text=text.replace("nnj.",""),text=text.replace("dnmt",""),text=text.replace("ndmt.",""),text=text.replace("ndmt",""),text=text.charAt(0).toUpperCase()+text.substring(1)}return updateTextScroll(),baseString};{var schedule=require("node-schedule");schedule.scheduleJob({hour:16,minute:39},function(){console.log("Time for tea!"),playText("End of the workday")})}$.subscribe("clearscreen",function(){var $hypotheses=$(".hypotheses ul");scrolled=!1,$hypotheses.empty(),alternativePrototype.clearString()});var a,n,g,Small={zero:0,one:1,two:2,to:2,too:2,three:3,four:4,"for":4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19,twenty:20,thirty:30,forty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90},Magnitude={hundred:100,thousand:1e3,million:1e6,billion:1e9,trillion:1e12,quadrillion:1e15,quintillion:1e18,sextillion:1e21,septillion:1e24,octillion:1e27,nonillion:1e30,decillion:1e33}},{"../Microphone":13,"node-schedule":8}],23:[function(require,module,exports){"use strict";var handleSelectedFile=require("./fileupload").handleSelectedFile;exports.initDragDrop=function(ctx){function handleFileUploadEvent(evt){var file=evt.dataTransfer.files[0];handleSelectedFile(ctx.token,file)}var dragAndDropTarget=$(document);dragAndDropTarget.on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),dragAndDropTarget.on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),dragAndDropTarget.on("drop",function(e){console.log("File dropped"),e.preventDefault();var evt=e.originalEvent;handleFileUploadEvent(evt)})}},{"./fileupload":25}],24:[function(require,module,exports){"use strict";exports.flashSVG=function(el){function loop(){el.animate({fill:"#A53725"},1e3,"linear").animate({fill:"white"},1e3,"linear")}el.css({fill:"#A53725"});var timer=setTimeout(loop,2e3);return timer},exports.stopFlashSVG=function(timer){el.css({fill:"white"}),clearInterval(timer)},exports.toggleImage=function(el,name){el.attr("src")==="images/"+name+".svg"?el.attr("src","images/stop-red.svg"):el.attr("src","images/stop.svg")};var restoreImage=exports.restoreImage=function(el,name){el.attr("src","images/"+name+".svg")};exports.stopToggleImage=function(timer,el,name){clearInterval(timer),restoreImage(el,name)}},{}],25:[function(require,module,exports){"use strict";var showError=require("./showerror").showError,showNotice=require("./showerror").showNotice,handleFileUpload=require("../handlefileupload").handleFileUpload,effects=require("./effects"),utils=require("../utils"),handleSelectedFile=exports.handleSelectedFile=function(){var running=!1;return localStorage.setItem("currentlyDisplaying","false"),function(token,file){function restoreUploadTab(){clearInterval(timer),effects.restoreImage(uploadImageTag,"upload"),uploadText.text("Select File")}$.publish("clearscreen"),localStorage.setItem("currentlyDisplaying","fileupload"),running=!0;var uploadImageTag=$("#fileUploadTarget > img"),timer=setInterval(effects.toggleImage,750,uploadImageTag,"stop"),uploadText=$("#fileUploadTarget > span");uploadText.text("Stop Transcribing"),$.subscribe("hardsocketstop",function(){restoreUploadTab(),running=!1});var currentModel=localStorage.getItem("currentModel");console.log("currentModel",currentModel);var blobToText=new Blob([file]).slice(0,4),r=new FileReader;r.readAsText(blobToText),r.onload=function(){var contentType;if("fLaC"===r.result)contentType="audio/flac",showNotice("Notice: browsers do not support playing FLAC audio, so no audio will accompany the transcription");else if("RIFF"===r.result){contentType="audio/wav";var audio=new Audio,wavBlob=new Blob([file],{type:"audio/wav"}),wavURL=URL.createObjectURL(wavBlob);audio.src=wavURL,audio.play(),$.subscribe("hardsocketstop",function(){audio.pause(),audio.currentTime=0})}else{if("OggS"!==r.result)return restoreUploadTab(),showError("Only WAV or FLAC or Opus files can be transcribed, please try another file format"),void localStorage.setItem("currentlyDisplaying","false");contentType="audio/ogg; codecs=opus";var audio=new Audio,opusBlob=new Blob([file],{type:"audio/ogg; codecs=opus"}),opusURL=URL.createObjectURL(opusBlob);audio.src=opusURL,audio.play(),$.subscribe("hardsocketstop",function(){audio.pause(),audio.currentTime=0})}handleFileUpload("fileupload",token,currentModel,file,contentType,function(socket){var blob=new Blob([file]),parseOptions={file:blob};utils.onFileProgress(parseOptions,function(chunk){socket.send(chunk)},function(){return running?!0:!1},function(evt){console.log("Error reading file: ",evt.message),showError("Error: "+evt.message)},function(){socket.send(JSON.stringify({action:"stop"}))})},function(){effects.stopToggleImage(timer,uploadImageTag,"upload"),uploadText.text("Select File"),localStorage.setItem("currentlyDisplaying","false")})}}}();exports.initFileUpload=function(ctx){var fileUploadDialog=$("#fileUploadDialog");fileUploadDialog.change(function(){var file=fileUploadDialog.get(0).files[0];handleSelectedFile(ctx.token,file)}),$("#fileUploadTarget").click(function(){var currentlyDisplaying=localStorage.getItem("currentlyDisplaying");return"fileupload"==currentlyDisplaying?(console.log("HARD SOCKET STOP"),$.publish("hardsocketstop"),void localStorage.setItem("currentlyDisplaying","false")):"sample"==currentlyDisplaying?void showError("Currently another file is playing, please stop the file or wait until it finishes"):"record"==currentlyDisplaying?void showError("Currently audio is being recorded, please stop recording before playing a sample"):(fileUploadDialog.val(null),void fileUploadDialog.trigger("click"))})}},{"../handlefileupload":15,"../utils":20,"./effects":24,"./showerror":32}],26:[function(require,module,exports){"use strict";var initSessionPermissions=require("./sessionpermissions").initSessionPermissions,initAnimatePanel=require("./animatepanel").initAnimatePanel,initShowTab=require("./showtab").initShowTab,initDragDrop=require("./dragdrop").initDragDrop,initPlaySample=require("./playsample").initPlaySample,initRecordButton=require("./recordbutton").initRecordButton,initFileUpload=require("./fileupload").initFileUpload,initDisplayMetadata=require("./displaymetadata").initDisplayMetadata;exports.initViews=function(ctx){console.log("Initializing views..."),initPlaySample(ctx),initDragDrop(ctx),initRecordButton(ctx),initFileUpload(ctx),initSessionPermissions(),initShowTab(),initAnimatePanel(),initShowTab(),initDisplayMetadata()}},{"./animatepanel":21,"./displaymetadata":22,"./dragdrop":23,"./fileupload":25,"./playsample":28,"./recordbutton":29,"./sessionpermissions":31,"./showtab":33}],27:[function(require,module,exports){var phrases=["Help me","Close help","Hi","Hello","Say hi","My name is {your name}","How do you talk so well","What do you do","Thank you","How are you","How are you doing","How's it going","What time is it","What day is it","What is X plus Y","What is X minus Y","Thank you","Where is the nearest hotel","Insurance example","Do you speak French","Do you speak Spanish","Do you speak English"];exports.getPhraseString=function(){for(var phraseString="",z=0;z<phrases.length;z++)phraseString+="<tr><td>"+phrases[z]+"</td></tr>";return phraseString}},{}],28:[function(require,module,exports){"use strict";function playOnly(text){console.log("Translation = "+text);var micOptions={bufferSize:8192},Microphone=require("../Microphone"),mic=new Microphone(micOptions);mic.pauseRecording();var utteranceOptions={text:text,voice:voice,sessionPermissions:1};synthesizeRequest(utteranceOptions,audio),mic.restartRecording()}function synthesizeRequest(options,audio){var downloadURL="/api/synthesize?voice="+options.voice+"&text="+encodeURIComponent(options.text)+"&X-WDC-PL-OPT-OUT="+options.sessionPermissions;if(options.download)return downloadURL+="&download=true",window.location.href=downloadURL,!0;audio.pause();try{audio.currentTime=0}catch(ex){}return audio.src=downloadURL,audio.play(),!0}var phrases=require("./phrases"),utils=require("../utils"),onFileProgress=utils.onFileProgress,handleFileUpload=require("../handlefileupload").handleFileUpload,showError=require("./showerror").showError,effects=require("./effects"),LOOKUP_TABLE={"en-US_BroadbandModel":["Us_English_Broadband_Sample_1.wav","Us_English_Broadband_Sample_2.wav"],"en-US_NarrowbandModel":["Us_English_Narrowband_Sample_1.wav","Us_English_Narrowband_Sample_2.wav"],"es-ES_BroadbandModel":["Es_ES_spk24_16khz.wav","Es_ES_spk19_16khz.wav"],"es-ES_NarrowbandModel":["Es_ES_spk24_8khz.wav","Es_ES_spk19_8khz.wav"],"pt-BR_BroadbandModel":["pt-BR_Sample1-16KHz.wav","pt-BR_Sample2-16KHz.wav"],"pt-BR_NarrowbandModel":["pt-BR_Sample1-8KHz.wav","pt-BR_Sample2-8KHz.wav"],"zh-CN_BroadbandModel":["zh-CN_sample1_for_16k.wav","zh-CN_sample2_for_16k.wav"],"zh-CN_NarrowbandModel":["zh-CN_sample1_for_8k.wav","zh-CN_sample2_for_8k.wav"]},voice="en-US_AllisonVoice";voice="en-US_MichaelVoice";var audio=$(".audio").get(0),playSample=function(){var running=!1;return localStorage.setItem("currentlyDisplaying","false"),localStorage.setItem("samplePlaying","false"),function(token,imageTag,sampleNumber,iconName,url){$.publish("clearscreen");var currentlyDisplaying=localStorage.getItem("currentlyDisplaying"),samplePlaying=localStorage.getItem("samplePlaying");if(samplePlaying===sampleNumber)return console.log("HARD SOCKET STOP"),$.publish("socketstop"),localStorage.setItem("currentlyDisplaying","false"),localStorage.setItem("samplePlaying","false"),effects.stopToggleImage(timer,imageTag,iconName),effects.restoreImage(imageTag,iconName),void(running=!1);if("record"===currentlyDisplaying)return void showError("Currently audio is being recorded, please stop recording before playing a sample");if("fileupload"===currentlyDisplaying||"false"!==samplePlaying)return void showError("Currently another file is playing, please stop the file or wait until it finishes");localStorage.setItem("currentlyDisplaying","sample"),localStorage.setItem("samplePlaying",sampleNumber),running=!0,$("#resultsText").val("");var timer=setInterval(effects.toggleImage,750,imageTag,iconName),xhr=new XMLHttpRequest;xhr.open("GET",url,!0),xhr.responseType="blob",xhr.onload=function(){var blob=xhr.response,currentModel=localStorage.getItem("currentModel")||"en-US_BroadbandModel",reader=new FileReader,blobToText=new Blob([blob]).slice(0,4);reader.readAsText(blobToText),reader.onload=function(){var contentType="fLaC"===reader.result?"audio/flac":"audio/wav";console.log("Uploading file",reader.result);var mediaSourceURL=URL.createObjectURL(blob),audio=new Audio;audio.src=mediaSourceURL,audio.play(),$.subscribe("hardsocketstop",function(){audio.pause(),audio.currentTime=0}),$.subscribe("socketstop",function(){audio.pause(),audio.currentTime=0}),handleFileUpload("sample",token,currentModel,blob,contentType,function(socket){var parseOptions={file:blob},samplingRate=-1!==currentModel.indexOf("Broadband")?16e3:8e3;onFileProgress(parseOptions,function(chunk){socket.send(chunk)},function(){return running?!0:!1},function(evt){console.log("Error reading file: ",evt.message)},function(){socket.send(JSON.stringify({action:"stop"}))},samplingRate)},function(){effects.stopToggleImage(timer,imageTag,iconName),effects.restoreImage(imageTag,iconName),localStorage.getItem("currentlyDisplaying","false"),localStorage.setItem("samplePlaying","false")})}},xhr.send()}}();exports.initPlaySample=function(ctx){!function(){var el=$(".play-sample-1");el.off("click"),el.click(function(){playOnly("Good morning everybody.  I am Bluemix.  We are here today to explain all the wonderful things you can do with Bluemix.  We have about 2 hours.  Kevin will be doing a short presentation followed by a demonstration of me.  Feel free to ask him any questions.  Hope you enjoy your introduction to Bluemix."),console.log("IN HERE")});var helpButton=$(".show-help");helpButton.off("click"),helpButton.click(function(){$(".show_help").css("visibility","visible");var phraseString=phrases.getPhraseString();$(".show_help").append('<H2>Help (say "Close help" to hide)</H2><table><tr><td><b>Phrases Supported</b></td></tr>'),$(".show_help").append(phraseString),$(".show_help").append("</table>"),playOnly("Here is how you use Hello Bluemix. Remember to click on the Start Conversation button to begin.")})}(ctx,LOOKUP_TABLE),function(){var fileName="audio/"+LOOKUP_TABLE[ctx.currentModel][1],el=$(".play-sample-2");el.off("click");var iconName="play",imageTag=el.find("img");el.click(function(){playSample(ctx.token,imageTag,"sample-2",iconName,fileName,function(result){console.log("Play sample result",result)})})}(ctx,LOOKUP_TABLE)}},{"../Microphone":13,"../handlefileupload":15,"../utils":20,"./effects":24,"./phrases":27,"./showerror":32}],29:[function(require,module,exports){"use strict";var Microphone=require("../Microphone"),handleMicrophone=require("../handlemicrophone").handleMicrophone,showError=require("./showerror").showError;exports.initRecordButton=function(ctx){var recordButton=$("#recordButton");recordButton.click(function(){var running=!1,token=ctx.token,micOptions={bufferSize:ctx.buffersize},mic=new Microphone(micOptions);return function(evt){evt.preventDefault();var currentModel=localStorage.getItem("currentModel"),currentlyDisplaying=localStorage.getItem("currentlyDisplaying");return"sample"==currentlyDisplaying||"fileupload"==currentlyDisplaying?void showError("Currently another file is playing, please stop the file or wait until it finishes"):(localStorage.setItem("currentlyDisplaying","record"),void(running?(console.log("Stopping microphone, sending stop action message"),recordButton.removeAttr("style"),recordButton.find("img").attr("src","images/microphone.svg"),$.publish("hardsocketstop"),mic.stop(),running=!1,localStorage.setItem("currentlyDisplaying","false")):($("#resultsText").val(""),console.log("Not running, handleMicrophone()"),handleMicrophone(token,currentModel,mic,function(err){if(err){var msg="Error: "+err.message;console.log(msg),showError(msg),running=!1,localStorage.setItem("currentlyDisplaying","false")}else recordButton.css("background-color","#d74108"),recordButton.find("img").attr("src","images/stop.svg"),console.log("starting mic"),mic.record(),running=!0}))))}}())}},{"../Microphone":13,"../handlemicrophone":16,"./showerror":32}],30:[function(require,module,exports){"use strict";var initPlaySample=require("./playsample").initPlaySample;exports.initSelectModel=function(ctx){ctx.models.forEach(function(model){model.name.indexOf("JP")>-1||$("#dropdownMenuList").append($("<li>").attr("role","presentation").append($("<a>").attr("role","menu-item").attr("href","/").attr("data-model",model.name).append(model.description.substring(0,model.description.length-1),8e3==model.rate?" (8KHz)":" (16KHz)")))}),$("#dropdownMenuList").click(function(evt){evt.preventDefault(),evt.stopPropagation(),console.log("Change view",$(evt.target).text());var newModelDescription=$(evt.target).text(),newModel=$(evt.target).data("model");$("#dropdownMenuDefault").empty().text(newModelDescription),$("#dropdownMenu1").dropdown("toggle"),localStorage.setItem("currentModel",newModel),ctx.currentModel=newModel,initPlaySample(ctx),$.publish("clearscreen")})}},{"./playsample":28}],31:[function(require,module,exports){"use strict";exports.initSessionPermissions=function(){console.log("Initializing session permissions handler");var sessionPermissionsRadio=$("#sessionPermissionsRadioGroup input[type='radio']");sessionPermissionsRadio.click(function(){var checkedValue=sessionPermissionsRadio.filter(":checked").val();console.log("checkedValue",checkedValue),localStorage.setItem("sessionPermissions",checkedValue)})}},{}],32:[function(require,module,exports){"use strict";exports.showError=function(msg){console.log("Error: ",msg);var errorAlert=$(".error-row");errorAlert.hide(),errorAlert.css("background-color","#d74108"),errorAlert.css("color","white");var errorMessage=$("#errorMessage");errorMessage.text(msg),errorAlert.show(),$("#errorClose").click(function(e){return e.preventDefault(),errorAlert.hide(),!1})},exports.showNotice=function(msg){console.log("Notice: ",msg);var noticeAlert=$(".notification-row");noticeAlert.hide(),noticeAlert.css("border","2px solid #ececec"),noticeAlert.css("background-color","#f4f4f4"),noticeAlert.css("color","black");var noticeMessage=$("#notificationMessage");noticeMessage.text(msg),noticeAlert.show(),$("#notificationClose").click(function(e){return e.preventDefault(),noticeAlert.hide(),!1})},exports.hideError=function(){var errorAlert=$(".error-row");errorAlert.hide()}},{}],33:[function(require,module,exports){"use strict";exports.initShowTab=function(){$('.nav-tabs a[data-toggle="tab"]').on("shown.bs.tab",function(e){var target=$(e.target).text();"JSON"===target&&$.publish("showjson")})}},{}]},{},[17]);